<!DOCTYPE html>
<!-- GitViz ‚Äì URL Builder & Editor
* what are you doing here ?
* are you trying to copy my code ? or looking if its ai generated ?
* if you are, you are not gonna find anything here.
* this is a custom code that i wrote for my own use.
* if you want to use it, you can, but you need to ask me for permission.
* if you are not trying to copy my code, or looking if its ai generated, then you can continue.
* i hope you enjoy my code.
* if you have any questions, feel free to ask me.
* if you have any suggestions, feel free to suggest them.
* if you have any bugs, feel free to report them.
-->
<html lang="fr" style="background: transparent !important;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Widget Preview</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght@400;700&family=Open+Sans:wght@400;700&family=Poppins:wght@400;700&family=Inter:wght@400;700&family=Lato:wght@400;700&family=Raleway:wght@400;700&family=Oswald:wght@400;700&family=Playfair+Display:wght@400;700&family=Merriweather:wght@400;700&family=Ubuntu:wght@400;700&family=Nunito:wght@400;700&family=Source+Sans+Pro:wght@400;700&family=Crimson+Text:wght@400;700&family=Libre+Baskerville:wght@400;700&family=PT+Sans:wght@400;700&family=PT+Serif:wght@400;700&family=Dancing+Script:wght@400;700&family=Pacifico&family=Bebas+Neue&family=Anton&family=Fjalla+One&family=Righteous&family=Bangers&family=Fredoka+One:wght@400;700&family=Comfortaa:wght@400;700&family=Quicksand:wght@400;700&family=Rubik:wght@400;700&family=Work+Sans:wght@400;700&family=Space+Grotesk:wght@400;700&family=DM+Sans:wght@400;700&family=Manrope:wght@400;700&family=Sora:wght@400;700&family=Outfit:wght@400;700&family=Plus+Jakarta+Sans:wght@400;700&family=Figtree:wght@400;700&family=Geist:wght@400;700&family=JetBrains+Mono:wght@400;700&family=Fira+Code:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            background: transparent !important;
        }

        body {
            font-family: Arial, sans-serif;
            background: transparent !important;
            color: #ffffff;
            overflow: hidden;
        }

        #chat-container {
            height: 100vh;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 10px;
            overflow: hidden;
            background: radial-gradient(1200px 600px at 10% -10%, rgba(145,70,255,.15), transparent 40%),
                        radial-gradient(1200px 600px at 110% 10%, rgba(54,209,220,.12), transparent 40%),
                        #0e0f14;
        }

        .chat-message {
            margin-bottom: 10px;
            display: block;
            animation: slideIn 0.3s ease-out;
            opacity: 0;
            transform: translateX(-20px);
            animation-fill-mode: forwards;
        }

        /* Chat Style: Default (current style) */
        .chat-style-default .chat-message {
            background: transparent;
            border: none;
            padding: 0;
        }

        /* Chat Style: Card */
        .chat-style-card .chat-message {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 8px 12px;
            backdrop-filter: blur(10px);
        }

        /* Chat Style: Bubble */
        .chat-style-bubble .chat-message {
            background: linear-gradient(135deg, rgba(145, 70, 255, 0.2), rgba(54, 209, 220, 0.2));
            border: 2px solid rgba(145, 70, 255, 0.3);
            border-radius: 20px;
            padding: 10px 16px;
            backdrop-filter: blur(10px);
        }

        /* Chat Style: Minimal */
        .chat-style-minimal .chat-message {
            background: rgba(255, 255, 255, 0.05);
            border-left: 3px solid rgba(0, 255, 136, 0.5);
            border-radius: 0;
            padding: 6px 12px;
        }

        /* Chat Style: Gradient */
        .chat-style-gradient .chat-message {
            background: linear-gradient(90deg, rgba(145, 70, 255, 0.15), rgba(54, 209, 220, 0.15));
            border: 1px solid rgba(145, 70, 255, 0.3);
            border-radius: 12px;
            padding: 10px 14px;
            box-shadow: 0 2px 8px rgba(145, 70, 255, 0.1);
        }

        /* Chat Style: Glass */
        .chat-style-glass .chat-message {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 10px 16px;
            backdrop-filter: blur(20px) saturate(180%);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .username {
            font-weight: bold;
            color: #00ff88;
            display: inline;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            font-size: var(--font-size-main, 16px);
            line-height: 20px;
        }

        .message-content {
            display: inline;
            word-wrap: break-word;
            word-break: break-word;
            line-height: 1.5;
            font-size: var(--font-size-main, 16px);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .separator {
            margin-right: 5px;
            font-weight: bold;
            color: #ffffff;
            font-size: var(--font-size-main, 16px);
        }

        .badge-display {
            margin-right: 5px;
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            gap: 3px;
            height: 20px;
            vertical-align: bottom;
        }

        .badge-image {
            width: 16px;
            height: 16px;
            display: inline-block;
            vertical-align: middle;
            object-fit: contain;
        }

        .emote-7tv {
            max-height: 16px;
            height: auto;
            max-width: 32px;
            width: auto;
            display: inline-block;
            vertical-align: middle;
            margin: 0 2px;
            object-fit: contain;
        }

        .emote-twitch {
            width: 16px;
            height: 16px;
            display: inline-block;
            vertical-align: middle;
            margin: 0 2px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Couleurs diff√©rentes pour les pseudos */
        .username.color-1 { color: #ff6b6b; }
        .username.color-2 { color: #4ecdc4; }
        .username.color-3 { color: #45b7d1; }
        .username.color-4 { color: #96ceb4; }
        .username.color-5 { color: #ffeaa7; }
        .username.color-6 { color: #dda0dd; }
        .username.color-7 { color: #98d8c8; }
        .username.color-8 { color: #f7dc6f; }
        .username.color-9 { color: #bb8fce; }
        .username.color-10 { color: #85c1e9; }

        .moderator {
            color: #00ff00 !important;
        }

        .vip {
            color: #ff69b4 !important;
        }

        .subscriber {
            color: #9146ff !important;
        }

        .predictions {
            color: #ff6600 !important;
        }

        .premium {
            color: #9146ff !important;
        }
    </style>
</head>
<body style="background: transparent !important; margin: 0; padding: 0;">
    <div id="chat-container"></div>

    <script>
        class ChatPreviewWidget {
            constructor() {
                this.container = document.getElementById('chat-container');
                this.maxMessages = 50;
                this.messages = new Map();
                this.messageCounter = 0;
                this.userColors = new Map();
                this.colorIndex = 0;
                this.colors = ['color-1', 'color-2', 'color-3', 'color-4', 'color-5',
                              'color-6', 'color-7', 'color-8', 'color-9', 'color-10'];

                // Parse URL parameters
                const urlParams = new URLSearchParams(window.location.search);
                this.channel = urlParams.get('channel') || 'streamer_channel';
                this.font = urlParams.get('font') || 'Arial';
                const modsParam = urlParams.get('moderators') || '';
                const vipsParam = urlParams.get('vips') || '';
                this.moderators = modsParam ? modsParam.split(',').map(m => m.trim().toLowerCase()) : [];
                this.vips = vipsParam ? vipsParam.split(',').map(v => v.trim().toLowerCase()) : [];

                const twitchClientIdParam = urlParams.get('twitch_client_id');
                const twitchAuthTokenParam = urlParams.get('twitch_auth_token');
                const broadcasterIdParam = urlParams.get('broadcaster_id');
                this.seventvEmoteSetId = urlParams.get('seventv_emote_set') || '';

                this.twitchClientId = twitchClientIdParam || '';
                this.twitchAuthToken = twitchAuthTokenParam || '';
                this.broadcasterId = broadcasterIdParam || '';

                // Style configuration
                this.fontSize = parseInt(urlParams.get('font_size')) || 16;
                this.fontEffect = urlParams.get('font_effect') || 'normal';
                this.chatStyle = urlParams.get('chat_style') || 'default';

                // Apply font
                this.applyFont(this.font);
                this.applyStyles();
                this.applyChatStyle();

                // Check if all credentials are present
                const hasAllCredentials = this.channel &&
                                         this.broadcasterId &&
                                         this.twitchClientId &&
                                         this.twitchAuthToken;

                if (hasAllCredentials) {
                    console.log('‚úÖ Toutes les credentials sont pr√©sentes - utilisation des donn√©es r√©elles du chat Twitch');
                this.connectToTwitchChat();
                    } else {
                    console.log('‚ö†Ô∏è Credentials manquantes - utilisation des messages mock√©s');
                    console.log(`   Channel: ${this.channel ? '‚úÖ' : '‚ùå'}`);
                    console.log(`   Broadcaster ID: ${this.broadcasterId ? '‚úÖ' : '‚ùå'}`);
                    console.log(`   Client ID: ${this.twitchClientId ? '‚úÖ' : '‚ùå'}`);
                    console.log(`   Auth Token: ${this.twitchAuthToken ? '‚úÖ' : '‚ùå'}`);

                    // Mock messages data
                    this.mockMessages = [
                        { nick: 'StreamerPro', text: 'Bienvenue dans le stream ! üéÆ', badges: { broadcaster: true }, userColor: '#9146ff' },
                        { nick: 'ViewerFan', text: 'Salut tout le monde !', badges: { subscriber: true, subscriberVersion: '12' } },
                        { nick: 'GameMaster', text: 'Ce jeu a l\'air vraiment cool !', badges: { vip: true } },
                        { nick: 'ChatUser', text: 'GG pour ce kill !', badges: {} },
                        { nick: 'ModHelper', text: 'Rappelez-vous de suivre la cha√Æne !', badges: { moderator: true } },
                        { nick: 'Subscriber1', text: 'Premier stream que je regarde et c\'est d√©j√† incroyable !', badges: { subscriber: true, subscriberVersion: '3' } },
                        { nick: 'Viewer2', text: 'Quel build tu utilises ?', badges: {} },
                        { nick: 'VIPUser', text: 'Merci pour le stream !', badges: { vip: true } },
                        { nick: 'FollowerOne', text: 'Je viens de follow, continue comme √ßa !', badges: {} },
                        { nick: 'Subscriber2', text: 'Sub 6 mois aujourd\'hui !', badges: { subscriber: true, subscriberVersion: '6' } },
                    ];

                    // Start showing mock messages
                    this.startMockMessages();
                }
            }

            applyFont(fontName) {
                if (!fontName) fontName = 'Arial';
                const systemFonts = ['Arial', 'Courier New', 'Georgia', 'Times New Roman', 'Verdana', 'Tahoma', 'Trebuchet MS', 'Impact', 'Comic Sans MS', 'Arial Black'];
                let fontFamily;
                if (systemFonts.includes(fontName)) {
                    fontFamily = fontName;
                    } else {
                    fontFamily = `'${fontName}'`;
                }
                document.documentElement.style.setProperty('--custom-font', `${fontFamily}, sans-serif`);
                document.body.style.fontFamily = `${fontFamily}, sans-serif`;
            }

            applyStyles() {
                const root = document.documentElement;

                // Apply font size
                root.style.setProperty('--font-size-main', `${this.fontSize}px`);

                // Apply font effect to all message elements
                const style = document.createElement('style');
                style.id = 'dynamic-chat-styles';
                const existingStyle = document.getElementById('dynamic-chat-styles');
                if (existingStyle) {
                    existingStyle.remove();
                }

                style.textContent = `
                    .username, .separator, .message-content {
                        font-size: var(--font-size-main, 16px) !important;
                    }
                    .username.font-${this.fontEffect},
                    .message-content.font-${this.fontEffect} {
                        ${this.getFontEffectCSS(this.fontEffect)}
                    }
                `;
                document.head.appendChild(style);

                // Apply font effect classes to existing messages
                this.applyFontEffectToMessages();
            }

            getFontEffectCSS(effect) {
                switch(effect) {
                    case 'hollow':
                        return `
                            -webkit-text-stroke: 2px;
                            -webkit-text-stroke-color: currentColor;
                            -webkit-text-fill-color: transparent;
                            color: transparent;
                        `;
                    case 'border':
                        return `
                            text-shadow:
                                -2px -2px 0 currentColor,
                                2px -2px 0 currentColor,
                                -2px 2px 0 currentColor,
                                2px 2px 0 currentColor,
                                0 -2px 0 currentColor,
                                0 2px 0 currentColor,
                                -2px 0 0 currentColor,
                                2px 0 0 currentColor;
                        `;
                    default:
                        return '';
                }
            }

            applyFontEffectToMessages() {
                if (this.fontEffect === 'normal') return;

                const usernames = document.querySelectorAll('.username');
                const messageContents = document.querySelectorAll('.message-content');

                usernames.forEach(el => {
                    el.classList.remove('font-normal', 'font-hollow', 'font-border');
                    el.classList.add(`font-${this.fontEffect}`);
                });

                messageContents.forEach(el => {
                    el.classList.remove('font-normal', 'font-hollow', 'font-border');
                    el.classList.add(`font-${this.fontEffect}`);
                });
            }

            applyChatStyle() {
                const container = document.getElementById('chat-container');
                if (!container) return;

                // Remove all chat style classes
                container.classList.remove(
                    'chat-style-default',
                    'chat-style-card',
                    'chat-style-bubble',
                    'chat-style-minimal',
                    'chat-style-gradient',
                    'chat-style-glass'
                );

                // Add the selected style
                container.classList.add(`chat-style-${this.chatStyle}`);
            }

            getUserColor(username) {
                if (!this.userColors.has(username)) {
                    this.userColors.set(username, this.colors[this.colorIndex % this.colors.length]);
                    this.colorIndex++;
                }
                return this.userColors.get(username);
            }

            getUserBadgeClass(badges) {
                if (!badges) return '';
                if (badges.moderator) return 'moderator';
                if (badges.vip) return 'vip';
                if (badges.subscriber) return 'subscriber';
                if (badges.predictions) return 'predictions';
                if (badges.partner) return 'partner';
                if (badges.premium || badges.prime) return 'premium';
                return '';
            }

            getBadgeUrl(badgeType, version = '1') {
                // Return null to use local fallback images
                return null;
            }

            addMessage(data) {
                const messageElement = document.createElement('div');
                messageElement.className = 'chat-message';

                const messageId = `msg_${++this.messageCounter}_${Date.now()}`;
                messageElement.setAttribute('data-message-id', messageId);

                const username = data.nick || data.username || 'Utilisateur';
                const message = data.text || data.message || '';

                let userColor = '';
                if (data.userColor) {
                    userColor = `style="color: ${data.userColor} !important;"`;
                } else {
                    userColor = `class="${this.getUserColor(username)}"`;
                }

                const badgeClass = this.getUserBadgeClass(data.badges);

                let badgeDisplay = '';
                if (data.badges) {
                    if (data.badges.broadcaster) {
                        badgeDisplay += `<img class="badge-image" src="broadcaster.png" alt="Broadcaster" title="Broadcaster" onerror="this.style.display='none'">`;
                    }
                    if (data.badges.moderator) {
                        badgeDisplay += `<img class="badge-image" src="moderator.png" alt="Moderator" title="Moderator" onerror="this.style.display='none'">`;
                    }
                    if (data.badges.vip) {
                        badgeDisplay += `<img class="badge-image" src="vip.png" alt="VIP" title="VIP" onerror="this.style.display='none'">`;
                    }
                    if (data.badges.subscriber) {
                        const subVersion = data.badges.subscriberVersion || '0';
                        let subBadgeFile = '1-mois.png';
                            switch(subVersion) {
                                case '0':
                            case '1': subBadgeFile = '1-mois.png'; break;
                            case '2': subBadgeFile = '2-mois.png'; break;
                            case '3': subBadgeFile = '3-mois.png'; break;
                            case '6': subBadgeFile = '6-mois.png'; break;
                            case '9': subBadgeFile = '9-mois.png'; break;
                            case '12': subBadgeFile = '1-an.png'; break;
                            case '18': subBadgeFile = '18-mois.png'; break;
                            case '24': subBadgeFile = '2-ans.png'; break;
                        }
                        badgeDisplay += `<img class="badge-image" src="${subBadgeFile}" alt="Subscriber ${subVersion}" title="Abonn√© ${subVersion} mois" onerror="this.style.display='none'">`;
                    }
                }

                const fontEffectClass = this.fontEffect !== 'normal' ? `font-${this.fontEffect}` : '';
                messageElement.innerHTML = `
                    <span class="badge-display">
                        ${badgeDisplay}
                    </span>
                    <span class="username ${badgeClass} ${fontEffectClass}" ${userColor}>${username}</span>
                    <span class="separator">:</span>
                    <span class="message-content ${fontEffectClass}">${message}</span>
                `;

                this.container.appendChild(messageElement);

                this.messages.set(messageId, {
                    id: messageId,
                    username: username,
                    element: messageElement,
                    timestamp: Date.now(),
                    text: message
                });

                this.limitMessages();
                this.scrollToBottom();
            }

            limitMessages() {
                while (this.container.children.length > this.maxMessages) {
                    this.container.removeChild(this.container.firstChild);
                }
            }

            scrollToBottom() {
                this.container.scrollTop = this.container.scrollHeight;
            }

            startMockMessages() {
                // Show initial messages
                this.mockMessages.forEach((msg, index) => {
                        setTimeout(() => {
                            this.addMessage(msg);
                    }, index * 1500);
                });

                // Continue cycling through messages
                let messageIndex = 0;
                setInterval(() => {
                    if (this.mockMessages.length > 0) {
                        const msg = this.mockMessages[messageIndex % this.mockMessages.length];
                        this.addMessage(msg);
                        messageIndex++;
                    }
                }, 3000);
            }

            connectToTwitchChat() {
                const socket = new WebSocket('wss://irc-ws.chat.twitch.tv:443');

                socket.onopen = () => {
                    console.log(`‚úÖ Connect√© au chat Twitch de ${this.channel}`);
                    socket.send('CAP REQ :twitch.tv/tags twitch.tv/commands');
                    socket.send('PASS SCHMOOPIIE');
                    socket.send('NICK justinfan12345');
                    socket.send(`JOIN #${this.channel}`);
                };

                socket.onmessage = (event) => {
                    const message = event.data;

                    if (message.startsWith('PING')) {
                        socket.send('PONG :tmi.twitch.tv');
                        return;
                    }

                    this.parseIRCMessage(message);
                };

                socket.onerror = (error) => {
                    console.error('‚ùå Erreur de connexion au chat Twitch:', error);
                };

                socket.onclose = () => {
                    console.log('üîå Connexion au chat Twitch ferm√©e');
            setTimeout(() => {
                        console.log('üîÑ Tentative de reconnexion...');
                        this.connectToTwitchChat();
            }, 5000);
                };
            }

            parseIRCMessage(rawMessage) {
                if (!rawMessage.includes('PRIVMSG')) return;

                try {
                    let username = 'Anonyme';
                    const displayNameMatch = rawMessage.match(/display-name=([^;]*)/);
                    if (displayNameMatch && displayNameMatch[1]) {
                        username = displayNameMatch[1];
                    } else {
                        const fallbackMatch = rawMessage.match(/:([^!]+)!/);
                        if (fallbackMatch) {
                            username = fallbackMatch[1];
                        }
                    }

                    const privmsgPattern = `PRIVMSG #${this.channel} :`;
                    const privmsgIndex = rawMessage.indexOf(privmsgPattern);
                    let messageText = '';

                    if (privmsgIndex !== -1) {
                        messageText = rawMessage.substring(privmsgIndex + privmsgPattern.length);
                        messageText = messageText.replace(/\r\n?|\n/g, '');
                    }

                    const badges = this.extractBadges(rawMessage);
                    let userColor = null;
                    try {
                        userColor = this.extractUserColor(rawMessage);
            } catch (error) {
                        userColor = null;
                    }

                    if (messageText.trim()) {
                        this.addMessage({
                        nick: username,
                            text: messageText,
                            badges: badges,
                            userColor: userColor
                        });
                    }
                } catch (error) {
                    console.error('‚ùå Erreur lors du parsing du message IRC:', error);
                }
            }

            extractBadges(rawMessage) {
                const badges = {};
                const badgeMatch = rawMessage.match(/badges=([^;]*)/);
                if (badgeMatch && badgeMatch[1]) {
                    const badgeString = badgeMatch[1];
                    if (badgeString.includes('broadcaster')) badges.broadcaster = true;
                    if (badgeString.includes('moderator')) badges.moderator = true;
                    if (badgeString.includes('vip')) badges.vip = true;
                    if (badgeString.includes('subscriber')) {
                        badges.subscriber = true;
                        const subMatch = badgeString.match(/subscriber\/(\d+)/);
                        if (subMatch) {
                            badges.subscriberVersion = subMatch[1];
                        }
                    }
                    if (badgeString.includes('premium')) badges.premium = true;
                    if (badgeString.includes('partner')) badges.partner = true;
                }
                return badges;
            }

            extractUserColor(rawMessage) {
                const colorMatch = rawMessage.match(/color=([^;]*)/);
                if (colorMatch && colorMatch[1] && colorMatch[1] !== '') {
                    return colorMatch[1];
                }
                return null;
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            window.chatPreviewWidget = new ChatPreviewWidget();
        });
    </script>
</body>
</html>
